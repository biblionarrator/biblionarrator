function Completely(a,b){var c=this;c.container=a,c._controls={},b.promptInnerHTML=b.promptInnerHTML||"";var d=document.createElement("input");d.className="completely-input",d.type="text",d.spellcheck=!1;var e=d.cloneNode();e.className="completely-hint",e.disabled="";var f=document.createElement("div");f.className="completely-wrapper";var g=document.createElement("div");if(g.className="completely-prompt",g.innerHTML=b.promptInnerHTML,void 0===document.body)throw"document.body is undefined. The library was wired up incorrectly.";document.body.appendChild(g);var h=g.getBoundingClientRect().right;f.appendChild(g),g.style.visibility="visible",g.style.left="-"+h+"px",f.style.marginLeft=h+"px",f.appendChild(e),f.appendChild(d);var i=document.createElement("div");i.className="completely-dropdown";var j=document.createElement("span");j.className="completely-spacer",document.body.appendChild(j),c._controls={input:d,hint:e,wrapper:f,prompt:g,dropdown:i,spacer:j},c._onMouseDown=function(){c.hideDropDown(),c.completed(this.__opt)},f.appendChild(i),c.container.appendChild(f),c._calculateWidthForText=function(a){return j.innerHTML=String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),j.getBoundingClientRect().right};var k,l=function(){d.value.length>0&&d.value!==k&&(c.tokenentry(d.value),k=d.value)};d.addEventListener?(d.addEventListener("input",l,!1),d.addEventListener("keyup",l,!1),d.addEventListener("change",l,!1)):(d.attachEvent("oninput",l),d.attachEvent("onkeyup",l),d.attachEvent("onchange",l));var m=function(a){a=a||window.event;var b=a.keyCode;if(("function"!=typeof c.onkeydown||c.onkeydown.apply(c,arguments)!==!1)&&33!=b&&34!=b)return 27==b?(c.canceled(),void 0):39!=b&&35!=b&&9!=b&&13!=b||(a.preventDefault(),a.stopPropagation(),!c.current)?40==b?c.moveSelection(1):38==b?c.moveSelection(-1):(e.value="",void 0):(c.completed(c.current),void 0)};b=b||{};for(var n in b)b.hasOwnProperty(n)&&(c[n]=b[n]);return d.addEventListener?d.addEventListener("keydown",m,!1):d.attachEvent("onkeydown",m),setTimeout(function(){d.focus()},0),c}Completely.prototype.update=function(){var a=this._controls.input.value,b=this.offset||0,c=a.substring(b),d=a.substring(0,b);this._controls.hint.value=d;for(var e=0;e<this.options.length;e++)if(this.match(this.options[e],c)){this._controls.hint.value=this._controls.hint.value+(this.hint(this.options[e])||""),this._controls.hint.__opt=this.options[e];break}this._controls.dropdown.style.left=this._calculateWidthForText(d)+"px",this.repaint(this.options,c)},Completely.prototype.repaint=function(a,b){var c=this._controls.dropdown;c.style.visibility="hidden",c.innerHTML="";var d=window.innerHeight||document.documentElement.clientHeight,e=c.parentNode.getBoundingClientRect(),f=e.top-6,g=d-e.bottom-6;this.ddoptions=[];for(var h=0;h<a.length;h++)if(a[h].__formatted=a[h].__formatted||this.format(a[h],b),a[h].__formatted){a[h].__idx=this.ddoptions.length,a[h].__hint=a[h].__hint||this.hint(a[h],b);var i=document.createElement("div");i.className="completely-option",i.__opt=a[h],i.onmousedown=this._onMouseDown,i.innerHTML=a[h].__formatted,this.ddoptions.push(i),c.appendChild(i)}0!==this.ddoptions.length&&(delete this.previous,this.current=this.ddoptions[0].__opt,(1!==this.ddoptions.length||b!==this.ddoptions[0].__opt.__hint)&&(this.ddoptions.length<2||(this.highlightSelection(),f>3*g?(c.style.maxHeight=f+"px",c.style.top="",c.style.bottom="100%"):(c.style.top="100%",c.style.bottom="",c.style.maxHeight=g+"px"),c.style.visibility="visible")))},Completely.prototype.hideDropDown=function(){this._controls.dropdown.style.visibility="hidden"},Completely.prototype.moveSelection=function(a){if("hidden"!==this._controls.dropdown.style.visibility){var b=this.current?this.current.__idx+a:a>0?0:this.ddoptions.length-1;(-1!==b||b!==this.ddoptions.length)&&(this.previous=this.current,this.current=this.ddoptions[b].__opt,this.highlightSelection())}},Completely.prototype.highlightSelection=function(){this.previous&&(this.ddoptions[this.previous.__idx].className="completely-option"),this.current&&(this.ddoptions[this.current.__idx].className="completely-option selected",this._controls.hint.value=this.current.__hint)},Completely.prototype.tokenentry=function(){this.update()},Completely.prototype.hint=function(a){return a},Completely.prototype.match=function(a,b){return 0===b.toLowerCase().indexOf(a.toLowerCase())},Completely.prototype.format=function(a,b){return 0===a.toLowerCase().indexOf(b.toLowerCase())?b+"<b>"+a.substring(b.length)+"</b>":void 0},Completely.prototype.canceled=function(){this._controls.hint.value=this._controls.input.value,this._controls.input.focus()},Completely.prototype.completed=function(){this._controls.input.value=this._controls.hint.value,this.hideDropDown()};